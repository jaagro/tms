<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jaagro.tms.biz.mapper.WaybillAnomalyMapperExt">

    <select id="listWaybillAnomalyByCondition" resultType="com.jaagro.tms.api.dto.anomaly.WaybillAnomalyDto"
            parameterType="com.jaagro.tms.api.dto.anomaly.WaybillAnomalyCondition">
        select
        wa.id, wa.waybill_id, wa.anomaly_type_id, wa.anomaly_desc, wa.processing_status, wa.processing_desc,
        wa.audit_status, wa.audit_desc, wa.verified_status, wa.adjust_status, wa.create_user_id,wa.create_user_type, wa.create_time,
        wa.processor_user_id, wa.processor_time, wa.audit_user_id, wa.audit_time,
        wat.type_name
        from waybill_anomaly wa
        inner join waybill_anomaly_type wat
        on (wa.anomaly_type_id=wat.id)
        where wa.enabled = 1 and wat.enabled=1
        <if test="createUserId != null and createUserId != ''">
            and wa.create_user_id = #{createUserId}
        </if>
        <if test="waybillId != null and waybillId!=''">
            and wa.waybill_id = #{waybillId}
        </if>
        <if test="processingStatus != null and processingStatus!=''">
            and wa.processing_status = #{processingStatus}
        </if>
        <if test="beginDate!=null and beginDate!='' and endDate!=null and endDate!=''">
            and wa.create_time between #{beginDate} and #{endDate}
        </if>
        <if test="anomalyId != null and anomalyId!=''">
            and wa.id = #{anomalyId}
        </if>
        <if test="anomalyTypeId != null and anomalyTypeId!=''">
            and wa.anomaly_type_id = #{anomalyTypeId}
        </if>
        order by wa.waybill_id ,wa.create_time desc
    </select>

</mapper>